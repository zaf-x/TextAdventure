{
  "name": "功能测试剧本",
  "start_node": "start",
  "shared_data": {
    "test_var": 0,
    "player_name": "测试者",
    "health": 100,
    "score": 0
  },
  "init_inputs": {
    "player_name": {
      "desc": "请输入玩家名称（2-10个字符）: ",
      "converter": "str",
      "condition": "2 <= len(val) <= 10",
      "condition_desc": "名称长度必须在2-10个字符之间"
    },
    "difficulty": {
      "desc": "请选择难度 (1-简单, 2-普通, 3-困难): ",
      "converter": "int",
      "condition": "1 <= val <= 3",
      "condition_desc": "请输入1、2或3"
    }
  },
  "onready_script": "\nwrite_data('health', 100)\nwrite_data('score', 0)\nwrite_data('items', [])\nwrite_data('visited_nodes', [])\nprint(f\"欢迎, {read_data('player_name')}! 难度设置为: {read_data('difficulty')}\")\n",
  "nodes": {
    "start": {
      "name": "起点",
      "description": "这是一个测试起点。当前变量: test_var={test_var}, health={health}, score={score}",
      "set_d": {
        "test_var": "test_var + 1"
      },
      "init_d": {
        "new_var": "'初始化值'"
      },
      "python_script": "\nvisited = read_data('visited_nodes')\nvisited.append('start')\nwrite_data('visited_nodes', visited)\nprint(\"执行了start节点的python_script\")\n",
      "options": {
        "选项A - 条件测试": {
          "desc": "测试条件显示 (score >= 0)",
          "next_node": "condition_test",
          "show_condition": "score >= 0",
          "move_condition": "True"
        },
        "选项B - 脚本测试": {
          "desc": "测试Python脚本执行",
          "next_node": "script_test",
          "show_condition": "True",
          "move_condition": "True"
        },
        "选项C - 隐藏选项": {
          "desc": "这个选项应该被隐藏",
          "next_node": "hidden_node",
          "show_condition": "False",
          "move_condition": "True"
        },
        "选项D - 不可选": {
          "desc": "这个选项显示但不能选择",
          "next_node": "unreachable",
          "show_condition": "True",
          "move_condition": "score >= 100",
          "cant_move_desc": "需要score >= 100才能选择 (当前: {score})"
        },
        "选项E - 强制跳转测试": {
          "desc": "前往强制跳转测试节点",
          "next_node": "force_test",
          "show_condition": "True",
          "move_condition": "True"
        }
      },
      "force_select": [],
      "end": false
    },
    "condition_test": {
      "name": "条件测试节点",
      "description": "测试各种条件判断。difficulty={difficulty}, health={health}",
      "set_d": {
        "score": "score + 10"
      },
      "python_script": "\nif read_data('difficulty') == 3:\n    write_data('health', read_data('health') - 20)\n    print(\"困难模式: 生命值-20\")\nelse:\n    write_data('health', read_data('health') + 10)\n    print(\"普通/简单模式: 生命值+10\")\n",
      "options": {
        "返回起点": {
          "desc": "回到start节点",
          "next_node": "start",
          "show_condition": "True",
          "move_condition": "True"
        },
        "前往结局": {
          "desc": "如果score >= 10可以前往结局",
          "next_node": "ending",
          "show_condition": "score >= 10",
          "move_condition": "score >= 10"
        },
        "困难模式专属": {
          "desc": "只有困难模式可见",
          "next_node": "hard_mode",
          "show_condition": "difficulty == 3",
          "move_condition": "True"
        }
      },
      "force_select": [],
      "end": false
    },
    "script_test": {
      "name": "脚本测试节点",
      "description": "测试复杂脚本执行。当前items: {items}",
      "set_d": {},
      "python_script": "\n# 测试各种内置函数\nimport math\nimport random\n\nitems = read_data('items')\nitems.append(f\"测试道具_{random.randint(1, 100)}\")\nwrite_data('items', items)\n\n# 测试数学运算\nradius = 5\narea = math.pi * pow(radius, 2)\nwrite_data('circle_area', round(area, 2))\n\nprint(f\"添加了道具，当前数量: {len(items)}\")\nprint(f\"圆面积计算: {read_data('circle_area')}\")\n",
      "onmove_script": "\nprint(\"离开script_test节点时执行\")\nwrite_data('score', read_data('score') + 5)\n",
      "options": {
        "返回": {
          "desc": "返回起点",
          "next_node": "start",
          "show_condition": "True",
          "move_condition": "True"
        }
      },
      "force_select": [],
      "end": false
    },
    "force_test": {
      "name": "强制跳转测试",
      "description": "这个节点将测试force_select功能。如果health < 50会自动跳转到low_health节点。",
      "set_d": {
        "test_var": "test_var + 10"
      },
      "force_select": [
        {
          "condition": "health < 50",
          "next_node": "low_health"
        },
        {
          "condition": "difficulty == 3",
          "next_node": "hard_warning"
        }
      ],
      "options": {
        "正常选项": {
          "desc": "如果没有触发强制跳转，显示此选项",
          "next_node": "start",
          "show_condition": "True",
          "move_condition": "True"
        }
      },
      "end": false
    },
    "low_health": {
      "name": "低生命值警告",
      "description": "警告: 你的生命值过低 ({health})! 这是强制跳转的节点。",
      "set_d": {
        "health": "min(health + 30, 100)"
      },
      "python_script": "\nprint(\"触发低生命值恢复机制\")\nwrite_data('score', read_data('score') - 5)\n",
      "options": {
        "继续": {
          "desc": "返回起点",
          "next_node": "start",
          "show_condition": "True",
          "move_condition": "True"
        }
      },
      "force_select": [],
      "end": false
    },
    "hard_warning": {
      "name": "困难模式警告",
      "description": "你选择了困难模式! 这是通过force_select跳转的。",
      "set_d": {},
      "options": {
        "明白": {
          "desc": "返回起点",
          "next_node": "start",
          "show_condition": "True",
          "move_condition": "True"
        }
      },
      "force_select": [],
      "end": false
    },
    "hard_mode": {
      "name": "困难模式专属节点",
      "description": "只有困难模式玩家能看到此节点。",
      "set_d": {
        "score": "score + 50"
      },
      "options": {
        "领取奖励并返回": {
          "desc": "获得50分并返回",
          "next_node": "condition_test",
          "show_condition": "True",
          "move_condition": "True"
        }
      },
      "force_select": [],
      "end": false
    },
    "hidden_node": {
      "name": "隐藏节点",
      "description": "如果你能看到这个，说明条件判断有问题。",
      "options": {
        "返回": {
          "desc": "返回",
          "next_node": "start",
          "show_condition": "True",
          "move_condition": "True"
        }
      },
      "force_select": [],
      "end": false
    },
    "ending": {
      "name": "测试结局",
      "description": "恭喜完成测试!\n最终统计:\n- 玩家: {player_name}\n- 难度: {difficulty}\n- 得分: {score}\n- 生命值: {health}\n- 访问节点: {visited_nodes}\n- 道具: {items}",
      "set_d": {},
      "end": true,
      "end_description": "测试完成! 所有功能正常工作。\n最终得分: {score}\n收集道具数: {len(items)}"
    },
    "unreachable": {
      "name": "不可达节点",
      "description": "这个节点是不可达的，用于测试条件判断。",
      "set_d": {},
      "end": true,
      "end_description": "你尝试前往不可达节点，但被阻止了。"
    }
  }
}